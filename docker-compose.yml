services:
  # Selenium Chrome node with VNC (optional - for direct browser access)
  chrome:
    image: selenium/standalone-chrome:latest
    container_name: jiomosa-chrome
    restart: unless-stopped
    shm_size: 2gb
    environment:
      - VNC_NO_PASSWORD=1
      - SE_NODE_MAX_SESSIONS=5
      - SE_NODE_SESSION_TIMEOUT=300
    ports:
      - "4444:4444"  # Selenium
      - "5900:5900"  # VNC
      - "7900:7900"  # noVNC web interface
    networks:
      - jiomosa-network
    volumes:
      - /dev/shm:/dev/shm

  # Renderer service - WebSocket-based real-time streaming
  renderer:
    build:
      context: ./renderer
      dockerfile: Dockerfile
    container_name: jiomosa-renderer
    restart: unless-stopped
    environment:
      - SELENIUM_HOST=chrome
      - SELENIUM_PORT=4444
    ports:
      - "5000:5000"
    depends_on:
      - chrome
    networks:
      - jiomosa-network
    volumes:
      - ./renderer:/app
      - ./kaios_client:/kaios_client:ro

  # Android WebApp - Mobile app launcher interface
  android-webapp:
    build:
      context: ./android_webapp
      dockerfile: Dockerfile
    container_name: jiomosa-android-webapp
    restart: unless-stopped
    environment:
      - JIOMOSA_SERVER=http://renderer:5000
      - CODESPACE_NAME=${CODESPACE_NAME}
      - GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN=${GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN}
    ports:
      - "9000:9000"
    depends_on:
      - renderer
    networks:
      - jiomosa-network
    volumes:
      - ./android_webapp:/app

networks:
  jiomosa-network:
    driver: bridge
