<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Jio Cloud Apps</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    html, body {
        width: 240px;
        height: 320px;
        overflow: hidden;
        font-family: Arial, sans-serif;
        font-size: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
    }
    .container {
        width: 240px;
        height: 320px;
        background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
    }
    .header {
        width: 240px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        text-align: center;
        padding: 8px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    .title {
        font-size: 16px;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .subtitle {
        font-size: 8px;
        color: rgba(255,255,255,0.8);
    }
    .grid {
        width: 240px;
        padding: 10px 8px;
    }
    .row {
        width: 224px;
        height: 72px;
        margin-bottom: 6px;
    }
    .row:after {
        content: "";
        display: block;
        clear: both;
    }
    .app {
        float: left;
        width: 70px;
        height: 68px;
        margin: 0 2px;
        text-align: center;
        padding: 8px 4px;
        background: #fff;
        border: none;
        -moz-border-radius: 12px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .app.sel {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .app.sel .name {
        color: #fff;
    }
    .icon {
        display: block;
        width: 36px;
        height: 36px;
        margin: 0 auto 4px auto;
        line-height: 36px;
        font-size: 12px;
        font-weight: bold;
        background: #667eea;
        color: #fff;
        -moz-border-radius: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .g { background: linear-gradient(135deg, #de5833 0%, #f09819 100%); }
    .y { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
    .t { background: linear-gradient(135deg, #1da1f2 0%, #0d8bd9 100%); }
    .f { background: linear-gradient(135deg, #1877f2 0%, #0d5bbd 100%); }
    .w { background: linear-gradient(135deg, #333 0%, #555 100%); }
    .n { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
    .we { background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); }
    .r { background: linear-gradient(135deg, #e1306c 0%, #f77737 100%); }
    .u { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .name {
        font-size: 9px;
        color: #555;
        overflow: hidden;
        font-weight: 500;
    }
    .footer {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 240px;
        height: 44px;
        background: #fff;
        padding: 6px;
        text-align: center;
        font-size: 8px;
        color: #888;
        border-top: 1px solid #e9ecef;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
    }
    .k {
        display: inline-block;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 2px 5px;
        margin: 0 1px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 7px;
    }
    #debug {
        position: absolute;
        top: 42px;
        left: 4px;
        font-size: 8px;
        color: #667eea;
        background: rgba(255,255,255,0.9);
        padding: 2px 4px;
        z-index: 999;
        -moz-border-radius: 4px;
        border-radius: 4px;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">JIO CLOUD APPS</div>
            <div class="subtitle">Cloud Browser</div>
        </div>

        <div id="debug"></div>

        <div class="grid" id="grid">
            <div class="row">
                <div class="app sel" data-i="0" data-u="https://duckduckgo.com">
                    <span class="icon g"><img src="https://duckduckgo.com/favicon.ico" alt="DuckDuckGo" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">DuckDuckGo</span>
                </div>
                <div class="app" data-i="1" data-a="youtube">
                    <span class="icon y"><img src="https://www.youtube.com/s/desktop/fe2e3e9e/img/favicon_32x32.png" alt="YouTube" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">YouTube</span>
                </div>
                <div class="app" data-i="2" data-u="https://mobile.twitter.com">
                    <span class="icon t"><img src="https://abs.twimg.com/favicons/twitter.2.ico" alt="Twitter" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">Twitter</span>
                </div>
            </div>
            <div class="row">
                <div class="app" data-i="3" data-u="https://m.facebook.com">
                    <span class="icon f"><img src="https://www.facebook.com/favicon.ico" alt="Facebook" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">Facebook</span>
                </div>
                <div class="app" data-i="4" data-u="https://www.wikipedia.org">
                    <span class="icon w"><img src="https://www.wikipedia.org/static/favicon/wikipedia.ico" alt="Wikipedia" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">Wikipedia</span>
                </div>
                <div class="app" data-i="5" data-u="https://news.google.com">
                    <span class="icon n"><img src="https://news.google.com/favicon.ico" alt="News" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">News</span>
                </div>
            </div>
            <div class="row">
                <div class="app" data-i="6" data-u="https://www.windy.com">
                    <span class="icon we"><img src="https://www.windy.com/favicon.ico" alt="Windy" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">Windy</span>
                </div>
                <div class="app" data-i="7" data-u="https://www.instagram.com">
                    <span class="icon r"><img src="https://www.instagram.com/favicon.ico" alt="Instagram" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">Instagram</span>
                </div>
                <div class="app" data-i="8" data-u="https://web.whatsapp.com">
                    <span class="icon" style="background:linear-gradient(135deg,#25d366 0%,#128c7e 100%)"><img src="https://web.whatsapp.com/favicon.ico" alt="WhatsApp" style="width:32px;height:32px;border-radius:8px;"></span>
                    <span class="name">WhatsApp</span>
                </div>
            </div>
        </div>

        <div class="footer">
            <div><span class="k">2</span>Up <span class="k">4</span>Left <span class="k">6</span>Right <span class="k">8</span>Down</div>
            <div style="margin-top:2px"><span class="k">5</span> or <span class="k">OK</span> to Select | <span class="k">#</span> Settings</div>
        </div>
    </div>

    <script>
    (function() {
        var idx = 0;
        var apps = document.querySelectorAll('.app');
        var debug = document.getElementById('debug');
        
        // Auto-detect server from current page URL
        var server = localStorage.getItem('jiomosa_server');
        if (!server) {
            server = window.location.protocol + '//' + window.location.host;
            localStorage.setItem('jiomosa_server', server);
        }

        function log(msg) {
            debug.textContent = msg;
            setTimeout(function() { debug.textContent = ''; }, 3000);
        }

        function sel() {
            for (var i = 0; i < apps.length; i++) {
                apps[i].className = (i === idx) ? 'app sel' : 'app';
            }
            localStorage.setItem('jiomosa_idx', idx);
        }

        function nav(d) {
            var old = idx;
            if (d === 'u' && idx >= 3) idx -= 3;
            else if (d === 'd' && idx < 6) idx += 3;
            else if (d === 'l' && idx % 3 > 0) idx--;
            else if (d === 'r' && idx % 3 < 2 && idx < 8) idx++;
            if (idx !== old) sel();
        }

        function go() {
            var app = apps[idx];
            var url = app.getAttribute('data-u');
            var nativeApp = app.getAttribute('data-a');
            
            // Handle native apps (YouTube, etc.)
            if (nativeApp === 'youtube') {
                log('Opening YouTube');
                window.location.href = 'youtube.html';
                return;
            }
            
            log('Opening: ' + (url || 'custom'));
            if (!url) {
                url = prompt('Enter URL:', 'https://');
                if (!url || url === 'https://') return;
            }
            // Server is auto-detected, no need to prompt
            localStorage.setItem('jiomosa_url', url);
            window.location.href = 'browser.html';
        }

        function settings() {
            var s = prompt('Server URL:', server || 'http://10.172.161.93:5000');
            if (s) {
                server = s;
                localStorage.setItem('jiomosa_server', s);
                alert('Server: ' + s);
            }
        }

        var saved = localStorage.getItem('jiomosa_idx');
        if (saved) idx = parseInt(saved, 10) || 0;
        sel();

        document.addEventListener('keydown', function(e) {
            var k = e.key || '';
            var c = e.keyCode || e.which;
            
            log('Key:' + k + ' Code:' + c);

            // D-pad navigation
            if (k === 'ArrowUp' || c === 38) { nav('u'); e.preventDefault(); return; }
            if (k === 'ArrowDown' || c === 40) { nav('d'); e.preventDefault(); return; }
            if (k === 'ArrowLeft' || c === 37) { nav('l'); e.preventDefault(); return; }
            if (k === 'ArrowRight' || c === 39) { nav('r'); e.preventDefault(); return; }

            // Number key navigation
            if (k === '2' || c === 50 || c === 98) { nav('u'); e.preventDefault(); return; }
            if (k === '8' || c === 56 || c === 104) { nav('d'); e.preventDefault(); return; }
            if (k === '4' || c === 52 || c === 100) { nav('l'); e.preventDefault(); return; }
            if (k === '6' || c === 54 || c === 102) { nav('r'); e.preventDefault(); return; }

            // Select/Enter - many possible keycodes for D-pad center
            // Including MicrophoneToggle (key sent by some KaiOS D-pad center)
            if (k === 'Enter' || k === '5' || k === 'Accept' || k === 'SoftRight' ||
                k === 'MicrophoneToggle' || k === 'Call' || k === 'GoBack' ||
                c === 13 || c === 53 || c === 101 || c === 32 || c === 160 || 
                c === 23 || c === 66 || c === 99 || c === 0) {
                go();
                e.preventDefault();
                return;
            }

            // Settings
            if (k === '#' || c === 163 || c === 35) {
                settings();
                e.preventDefault();
                return;
            }
        }, true);

        // Also handle click/tap on apps
        for (var i = 0; i < apps.length; i++) {
            apps[i].addEventListener('click', function(e) {
                var newIdx = parseInt(this.getAttribute('data-i'), 10);
                idx = newIdx;
                sel();
                go();
            }, false);
        }
    })();
    </script>
</body>
</html>
